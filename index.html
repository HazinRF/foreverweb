<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–ª—è –Ω–∞—Å üíôüíó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f0f0f;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            touch-action: none; /* –í–∞–∂–Ω–æ –¥–ª—è iOS */
        }
        #status {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 16px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        #canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
        .vibration-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
            transform: translate(-50%, -50%);
            animation: pulse 0.3s ease-out;
        }
        @keyframes pulse {
            0% { 
                box-shadow: 0 0 0 0px rgba(52, 152, 219, 0.7); 
                opacity: 1;
            }
            100% { 
                box-shadow: 0 0 0 30px rgba(52, 152, 219, 0); 
                opacity: 0;
            }
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="status">üíô –û–Ω (Android)</div>
    <canvas id="canvas"></canvas>

    <script>
        // === 1. –ù–ï–ú–ï–î–õ–ï–ù–ù–ê–Ø –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø (–±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è) ===
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('status');

        // === 2. –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–õ–ê–¢–§–û–†–ú–´ (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –ø–æ UserAgent) ===
        const userAgent = navigator.userAgent.toLowerCase();
        const isIOS = /iphone|ipad|ipod/.test(userAgent);
        const isAndroid = /android/.test(userAgent);
        
        let userColor, userName;
        
        if (isAndroid) {
            userColor = '#3498db'; // –°–∏–Ω–∏–π
            userName = '–û–Ω (Android)';
            statusEl.innerHTML = 'üíô –û–Ω (Android)';
            statusEl.style.color = '#3498db';
        } else if (isIOS) {
            userColor = '#e84393'; // –†–æ–∑–æ–≤—ã–π
            userName = '–û–Ω–∞ (iPhone)';
            statusEl.innerHTML = 'üíó –û–Ω–∞ (iPhone)';
            statusEl.style.color = '#e84393';
        } else {
            userColor = '#9b59b6'; // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π –¥–ª—è –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
            userName = '–ì–æ—Å—Ç—å';
            statusEl.textContent = '–ì–æ—Å—Ç—å (–ü–ö?)';
            statusEl.style.color = '#9b59b6';
        }

        // === 3. –ù–ê–°–¢–†–û–ô–ö–ê CANVAS ===
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            // –ó–∞–ª–∏–≤–∞–µ–º —á—ë—Ä–Ω—ã–º —Ñ–æ–Ω
            ctx.fillStyle = '#0f0f0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas(); // –í—ã–∑—ã–≤–∞–µ–º –°–†–ê–ó–£

        let activeLines = [];

        // === 4. –í–ò–ë–†–û–≠–§–§–ï–ö–¢ ===
        function triggerVibrationEffect(x, y) {
            // –ù–∞—Å—Ç–æ—è—â–∞—è –≤–∏–±—Ä–∞—Ü–∏—è (—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Android, –Ω–∞ iOS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ)
            if (navigator.vibrate) {
                navigator.vibrate(10); // –û—á–µ–Ω—å –∫–æ—Ä–æ—Ç–∫–∏–π –∏–º–ø—É–ª—å—Å
            }
            
            // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ)
            const effect = document.createElement('div');
            effect.className = 'vibration-effect';
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            effect.style.borderColor = userColor;
            effect.style.boxShadow = `0 0 0 0px ${userColor}80`;
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 300);
        }

        // === 5. –û–ë–†–ê–ë–û–¢–ö–ê –ö–ê–°–ê–ù–ò–ô (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞) ===
        canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
        canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
        canvas.addEventListener('touchend', handleTouchEnd);

        function handleTouchStart(e) {
            e.preventDefault(); // –í–∞–∂–Ω–æ!
            const touch = e.changedTouches[0];
            
            // –í–∏–±—Ä–∞—Ü–∏—è/—ç—Ñ—Ñ–µ–∫—Ç
            triggerVibrationEffect(touch.clientX, touch.clientY);
            
            // –†–∏—Å—É–µ–º –æ—Ç–ø–µ—á–∞—Ç–æ–∫
            drawFingerprint(touch.clientX, touch.clientY);
            
            // –ù–∞—á–∏–Ω–∞–µ–º –Ω–æ–≤—É—é –ª–∏–Ω–∏—é –¥–ª—è —Å–≤–∞–π–ø–∞
            activeLines.push({
                id: touch.identifier,
                points: [{x: touch.clientX, y: touch.clientY}],
                color: userColor,
                width: isIOS ? 12 : 10,
                startTime: Date.now()
            });
            
            console.log('Touch start', touch.identifier); // –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
        }

        function handleTouchMove(e) {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                let line = activeLines.find(l => l.id === touch.identifier);
                if (line) {
                    line.points.push({
                        x: touch.clientX, 
                        y: touch.clientY
                    });
                    redrawCanvas(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –í–°–ï –ª–∏–Ω–∏–∏
                }
            }
        }

        function handleTouchEnd(e) {
            for (let touch of e.changedTouches) {
                setTimeout(() => {
                    activeLines = activeLines.filter(l => l.id !== touch.identifier);
                    redrawCanvas(); // –£–±–∏—Ä–∞–µ–º –∏—Å—á–µ–∑–Ω—É–≤—à—É—é –ª–∏–Ω–∏—é
                }, 3000); // –õ–∏–Ω–∏—è –∏—Å—á–µ–∑–Ω–µ—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            }
        }

        // === 6. –§–£–ù–ö–¶–ò–ò –†–ò–°–û–í–ê–ù–ò–Ø ===
        function drawFingerprint(x, y) {
            ctx.save();
            ctx.globalAlpha = 0.9;
            
            // –ü—Ä–æ—Å—Ç–æ–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫ (–∫—Ä—É–≥–∏)
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, Math.PI * 2);
            ctx.fillStyle = userColor;
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.strokeStyle = userColor;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            ctx.restore();
        }

        function redrawCanvas() {
            // 1. –û—á–∏—â–∞–µ–º canvas –ø–æ–ª–Ω–æ—Å—Ç—å—é
            ctx.fillStyle = '#0f0f0f';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 2. –†–∏—Å—É–µ–º –í–°–ï –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∏–Ω–∏–∏
            activeLines.forEach(line => {
                if (line.points.length < 2) return;
                
                ctx.beginPath();
                ctx.moveTo(line.points[0].x, line.points[0].y);
                
                for (let i = 1; i < line.points.length; i++) {
                    ctx.lineTo(line.points[i].x, line.points[i].y);
                }
                
                ctx.strokeStyle = line.color;
                ctx.lineWidth = line.width;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.stroke();
            });
        }

        // === 7. –ü–û–î–î–ï–†–ñ–ö–ê –ú–´–®–ò (–¥–ª—è —Ç–µ—Å—Ç–∞ –Ω–∞ –ü–ö) ===
        let isMouseDown = false;
        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            const x = e.clientX;
            const y = e.clientY;
            
            triggerVibrationEffect(x, y);
            drawFingerprint(x, y);
            
            activeLines.push({
                id: 'mouse',
                points: [{x, y}],
                color: userColor,
                width: 8,
                startTime: Date.now()
            });
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isMouseDown) return;
            let line = activeLines.find(l => l.id === 'mouse');
            if (line) {
                line.points.push({x: e.clientX, y: e.clientY});
                redrawCanvas();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
            setTimeout(() => {
                activeLines = activeLines.filter(l => l.id !== 'mouse');
                redrawCanvas();
            }, 3000);
        });

        // === 8. –°–û–û–ë–©–ï–ù–ò–ï –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï ===
        setTimeout(() => {
            alert("üíå –°–∞–π—Ç –≥–æ—Ç–æ–≤! –ö–∞—Å–∞–π—Å—è —ç–∫—Ä–∞–Ω–∞, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥.");
        }, 500);
        
        console.log('–°–∞–π—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω. –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:', isIOS ? 'iOS' : isAndroid ? 'Android' : '–î—Ä—É–≥–∞—è');
    </script>
</body>
</html>