<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞—à–∞ —Å–≤—è–∑—å üíôüíó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        /* –ö–ª—é—á–µ–≤–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ —Ä–∏—Å–æ–≤–∞–Ω–∏—è –Ω–∞ iOS */
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0f0f0f;
            color: #fff;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            /* –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∂–µ—Å—Ç–æ–≤ –Ω–∞ iOS –¥–ª—è canvas */
            touch-action: none;
        }
        #status {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 16px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        #canvas {
            display: block;
            width: 100%;
            height: 100%;
            /* –£–ª—É—á—à–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
        #instructions {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            font-size: 18px;
            color: #aaa;
            padding: 0 20px;
        }
        .vibration-effect {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 50;
            transform: translate(-50%, -50%);
            animation: pulse 0.3s ease-out;
        }
        @keyframes pulse {
            0% { 
                box-shadow: 0 0 0 0px rgba(52, 152, 219, 0.7); 
                opacity: 1;
            }
            100% { 
                box-shadow: 0 0 0 30px rgba(52, 152, 219, 0); 
                opacity: 0;
            }
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="status">–û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤–∞—à–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ...</div>
    <canvas id="canvas"></canvas>
    <div id="instructions">–ö–æ—Å–Ω–∏—Å—å —ç–∫—Ä–∞–Ω–∞ –∏–ª–∏ —Ä–∏—Å—É–π –ø–∞–ª—å—Ü–µ–º üí´</div>

    <script>
        // === 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ===
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const statusEl = document.getElementById('status');
        const instructionsEl = document.getElementById('instructions');

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, iOS –ª–∏ —ç—Ç–æ
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isAndroid = /Android/.test(navigator.userAgent);

        // –¶–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        let userColor = '#9b59b6'; // –§–∏–æ–ª–µ—Ç–æ–≤—ã–π (–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π)
        let userCountry = '–ù–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ';
        let userName = '–î—Ä—É–≥';

        // === 2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç) ===
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω—ã–π, –Ω–æ –ø—Ä–æ—Å—Ç–æ–π —Å–µ—Ä–≤–∏—Å
        async function detectUser() {
            try {
                const response = await fetch('https://get.geojs.io/v1/ip/country.json');
                const data = await response.json();
                userCountry = data.name || data.country;
                
                if (data.country === 'RU') {
                    userColor = '#3498db'; // –°–∏–Ω–∏–π
                    userName = '–û–Ω';
                    statusEl.innerHTML = 'üíô –û–Ω –≤ –†–æ—Å—Å–∏–∏';
                } else {
                    userColor = '#e84393'; // –†–æ–∑–æ–≤—ã–π
                    userName = '–û–Ω–∞';
                    statusEl.innerHTML = `üíó –ì–æ—Å—Ç—å –∏–∑ ${userCountry}`;
                }
            } catch (error) {
                // –ï—Å–ª–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, —É—Å—Ç–∞–Ω–æ–≤–∏–º —Ü–≤–µ—Ç–∞ –≤—Ä—É—á–Ω—É—é
                // –ó–ê–ü–û–õ–ù–ò–¢–ï –°–¢–†–û–ö–£ –ù–ò–ñ–ï! –£–∫–∞–∂–∏—Ç–µ –∑–¥–µ—Å—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –≤–∞—Å
                // –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã –≤—Å–µ–≥–¥–∞ –∑–∞—Ö–æ–¥–∏—Ç–µ —Å Android: userColor = '#3498db';
                // –î–ª—è –¥–µ–≤—É—à–∫–∏ —Ü–≤–µ—Ç –±—É–¥–µ—Ç —Ä–æ–∑–æ–≤—ã–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                userColor = isAndroid ? '#3498db' : '#e84393';
                userName = isAndroid ? '–û–Ω' : '–û–Ω–∞';
                statusEl.textContent = `–ü—Ä–∏–≤–µ—Ç, ${userName}!`;
            }
            
            setTimeout(() => {
                instructionsEl.classList.add('hidden');
            }, 4000);
        }

        // === 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Canvas ===
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            redrawCanvas();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        let activeLines = [];
        let touchStartTime = 0;
        let touchStartX = 0;
        let touchStartY = 0;

        // === 4. –í–∏–±—Ä–æ—ç—Ñ—Ñ–µ–∫—Ç (–∫—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π) ===
        function triggerVibrationEffect(x, y) {
            // –ü—Ä–æ–±—É–µ–º –Ω–∞—Å—Ç–æ—è—â—É—é –≤–∏–±—Ä–∞—Ü–∏—é (—Å—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Android)
            if (navigator.vibrate && (isAndroid || (isIOS && window.navigator.standalone))) {
                navigator.vibrate(20);
            }
            
            // –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç (–æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è iOS)
            const effect = document.createElement('div');
            effect.className = 'vibration-effect';
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            effect.style.borderColor = userColor;
            effect.style.boxShadow = `0 0 0 0px ${userColor}80`;
            
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 500);
        }

        // === 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏–π ===
        canvas.addEventListener('touchstart', handleTouchStart);
        canvas.addEventListener('touchmove', handleTouchMove);
        canvas.addEventListener('touchend', handleTouchEnd);

        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.changedTouches[0];
            touchStartTime = Date.now();
            touchStartX = touch.clientX;
            touchStartY = touch.clientY;
            
            // –≠—Ç–æ —Ç–∞–ø –∏–ª–∏ –Ω–∞—á–∞–ª–æ —Å–ª–∞–π–¥–∞?
            // –¢–∞–ø - –∫–æ—Ä–æ—Ç–∫–æ–µ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏–µ –±–µ–∑ –¥–≤–∏–∂–µ–Ω–∏—è
            // –°–ª–∞–π–¥ - –¥–≤–∏–∂–µ–Ω–∏–µ –ø–∞–ª—å—Ü–µ–º
            
            triggerVibrationEffect(touch.clientX, touch.clientY);
            drawFingerprint(touch.clientX, touch.clientY);
            
            activeLines.push({
                id: touch.identifier,
                points: [{x: touch.clientX, y: touch.clientY}],
                color: userColor,
                width: isIOS ? 10 : 8, // –ù–∞ iOS –¥–µ–ª–∞–µ–º —Å–ª–µ–¥ —á—É—Ç—å —Ç–æ–ª—â–µ
                startTime: Date.now()
            });
        }

        function handleTouchMove(e) {
            e.preventDefault();
            for (let touch of e.changedTouches) {
                let line = activeLines.find(l => l.id === touch.identifier);
                if (line) {
                    line.points.push({
                        x: touch.clientX, 
                        y: touch.clientY,
                        time: Date.now()
                    });
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
                    if (line.points.length > 50) {
                        line.points.shift();
                    }
                    
                    redrawCanvas();
                }
            }
        }

        function handleTouchEnd(e) {
            for (let touch of e.changedTouches) {
                let line = activeLines.find(l => l.id === touch.identifier);
                if (!line) continue;
                
                const touchDuration = Date.now() - line.startTime;
                const touchEndX = touch.clientX;
                const touchEndY = touch.clientY;
                
                // –ï—Å–ª–∏ –±—ã–ª–æ –∫–æ—Ä–æ—Ç–∫–æ–µ –∫–∞—Å–∞–Ω–∏–µ —Å –º–∞–ª—ã–º –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ–º - —ç—Ç–æ —Ç–∞–ø
                const distance = Math.sqrt(
                    Math.pow(touchEndX - touchStartX, 2) + 
                    Math.pow(touchEndY - touchStartY, 2)
                );
                
                if (touchDuration < 300 && distance < 10) {
                    // –≠—Ç–æ –±—ã–ª —á–∏—Å—Ç—ã–π —Ç–∞–ø - –æ—Å—Ç–∞–≤–ª—è–µ–º –æ—Ç–ø–µ—á–∞—Ç–æ–∫ –¥–æ–ª—å—à–µ
                    setTimeout(() => {
                        activeLines = activeLines.filter(l => l.id !== touch.identifier);
                        redrawCanvas();
                    }, 5000); // –û—Ç–ø–µ—á–∞—Ç–æ–∫ –∏—Å—á–µ–∑–∞–µ—Ç —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                } else {
                    // –≠—Ç–æ –±—ã–ª —Å–ª–∞–π–¥ - –∏—Å—á–µ–∑–∞–µ—Ç —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        activeLines = activeLines.filter(l => l.id !== touch.identifier);
                        redrawCanvas();
                    }, 3000);
                }
            }
        }

        // === 6. –§—É–Ω–∫—Ü–∏–∏ —Ä–∏—Å–æ–≤–∞–Ω–∏—è ===
        function drawFingerprint(x, y) {
            ctx.save();
            ctx.globalAlpha = 0.9;
            
            // –í–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥
            ctx.beginPath();
            ctx.arc(x, y, 15, 0, Math.PI * 2);
            ctx.strokeStyle = userColor;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—Ä—É–≥
            ctx.beginPath();
            ctx.arc(x, y, 8, 0, Math.PI * 2);
            ctx.fillStyle = userColor;
            ctx.fill();
            
            // –õ–∏–Ω–∏–∏ —É–∑–æ—Ä–∞
            for (let i = 0; i < 6; i++) {
                const angle = (Math.PI * 2 / 6) * i;
                const length = 10;
                ctx.beginPath();
                ctx.moveTo(
                    x + Math.cos(angle) * 10,
                    y + Math.sin(angle) * 10
                );
                ctx.lineTo(
                    x + Math.cos(angle) * (10 + length),
                    y + Math.sin(angle) * (10 + length)
                );
                ctx.strokeStyle = userColor;
                ctx.lineWidth = 2;
                ctx.stroke();
            }
            
            ctx.restore();
        }

        function redrawCanvas() {
            // –û—á–∏—â–∞–µ–º —Å –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å—é –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —à–ª–µ–π—Ñ–∞
            ctx.fillStyle = 'rgba(15, 15, 15, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            activeLines.forEach(line => {
                if (line.points.length < 2) return;
                
                // –†–∏—Å—É–µ–º –ø–ª–∞–≤–Ω—É—é –ª–∏–Ω–∏—é
                ctx.beginPath();
                ctx.moveTo(line.points[0].x, line.points[0].y);
                
                for (let i = 1; i < line.points.length; i++) {
                    const point = line.points[i];
                    ctx.lineTo(point.x, point.y);
                }
                
                ctx.strokeStyle = line.color;
                ctx.lineWidth = line.width;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.stroke();
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–µ
                if (line.points.length > 1) {
                    const lastPoint = line.points[line.points.length - 1];
                    const gradient = ctx.createRadialGradient(
                        lastPoint.x, lastPoint.y, 0,
                        lastPoint.x, lastPoint.y, line.width * 2
                    );
                    gradient.addColorStop(0, line.color + 'FF');
                    gradient.addColorStop(1, line.color + '00');
                    
                    ctx.beginPath();
                    ctx.arc(lastPoint.x, lastPoint.y, line.width * 2, 0, Math.PI * 2);
                    ctx.fillStyle = gradient;
                    ctx.fill();
                }
            });
        }

        // === 7. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º—ã—à–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ===
        let isMouseDown = false;
        canvas.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            const x = e.clientX;
            const y = e.clientY;
            
            triggerVibrationEffect(x, y);
            drawFingerprint(x, y);
            
            activeLines.push({
                id: 'mouse',
                points: [{x, y}],
                color: userColor,
                width: 8,
                startTime: Date.now()
            });
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isMouseDown) return;
            let line = activeLines.find(l => l.id === 'mouse');
            if (line) {
                line.points.push({x: e.clientX, y: e.clientY});
                redrawCanvas();
            }
        });

        canvas.addEventListener('mouseup', () => {
            isMouseDown = false;
            const line = activeLines.find(l => l.id === 'mouse');
            if (line) {
                setTimeout(() => {
                    activeLines = activeLines.filter(l => l.id !== 'mouse');
                    redrawCanvas();
                }, 3000);
            }
        });

        // === 8. –ó–∞–ø—É—Å–∫ ===
        detectUser();
        
        // –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        setTimeout(() => {
            alert("üíå –≠—Ç–æ—Ç —Å–∞–π—Ç —Å–æ–∑–¥–∞–Ω, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–≤—è–∑—å, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ. –ö–æ—Å–Ω–∏—Å—å —ç–∫—Ä–∞–Ω–∞, –∏ —è —ç—Ç–æ –ø–æ—á—É–≤—Å—Ç–≤—É—é.");
        }, 1000);
    </script>
</body>
</html>